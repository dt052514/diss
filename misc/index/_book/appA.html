<!DOCTYPE html>
<html >

<head>

  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <title>National Oil Companies as International Investors</title>
  <meta name="description" content="A dissertation at the intersection of political economy and business studies.">
  <meta name="generator" content="bookdown 0.7 and GitBook 2.6.7">

  <meta property="og:title" content="National Oil Companies as International Investors" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="A dissertation at the intersection of political economy and business studies." />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="National Oil Companies as International Investors" />
  
  <meta name="twitter:description" content="A dissertation at the intersection of political economy and business studies." />
  

<meta name="author" content="David J. Tingle">



  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">
  
  
<link rel="prev" href="paper2.html">
<link rel="next" href="colophon.html">
<style type="text/css">
p.abstract{
  text-align: center;
  font-weight: bold;
}
div.abstract{
  margin: auto;
  width: 90%;
}
</style>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />







<script src="libs/kePrint-0.0.1/kePrint.js"></script>


<style type="text/css">
div.sourceCode { overflow-x: auto; }
table.sourceCode, tr.sourceCode, td.lineNumbers, td.sourceCode {
  margin: 0; padding: 0; vertical-align: baseline; border: none; }
table.sourceCode { width: 100%; line-height: 100%; }
td.lineNumbers { text-align: right; padding-right: 4px; padding-left: 4px; color: #aaaaaa; border-right: 1px solid #aaaaaa; }
td.sourceCode { padding-left: 5px; }
code > span.kw { color: #007020; font-weight: bold; } /* Keyword */
code > span.dt { color: #902000; } /* DataType */
code > span.dv { color: #40a070; } /* DecVal */
code > span.bn { color: #40a070; } /* BaseN */
code > span.fl { color: #40a070; } /* Float */
code > span.ch { color: #4070a0; } /* Char */
code > span.st { color: #4070a0; } /* String */
code > span.co { color: #60a0b0; font-style: italic; } /* Comment */
code > span.ot { color: #007020; } /* Other */
code > span.al { color: #ff0000; font-weight: bold; } /* Alert */
code > span.fu { color: #06287e; } /* Function */
code > span.er { color: #ff0000; font-weight: bold; } /* Error */
code > span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
code > span.cn { color: #880000; } /* Constant */
code > span.sc { color: #4070a0; } /* SpecialChar */
code > span.vs { color: #4070a0; } /* VerbatimString */
code > span.ss { color: #bb6688; } /* SpecialString */
code > span.im { } /* Import */
code > span.va { color: #19177c; } /* Variable */
code > span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code > span.op { color: #666666; } /* Operator */
code > span.bu { } /* BuiltIn */
code > span.ex { } /* Extension */
code > span.pp { color: #bc7a00; } /* Preprocessor */
code > span.at { color: #7d9029; } /* Attribute */
code > span.do { color: #ba2121; font-style: italic; } /* Documentation */
code > span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code > span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code > span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Overview</a></li>
<li class="chapter" data-level="1" data-path="paper1.html"><a href="paper1.html"><i class="fa fa-check"></i><b>1</b> What is NOC Internationalization?</a><ul>
<li class="chapter" data-level="1.1" data-path="paper1.html"><a href="paper1.html#intro01"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="paper1.html"><a href="paper1.html#motiv01"><i class="fa fa-check"></i><b>1.2</b> Motivation</a><ul>
<li class="chapter" data-level="1.2.1" data-path="paper1.html"><a href="paper1.html#what-are-national-oil-companies"><i class="fa fa-check"></i><b>1.2.1</b> What are National Oil Companies?</a></li>
<li class="chapter" data-level="1.2.2" data-path="paper1.html"><a href="paper1.html#what-do-we-know-about-nocs"><i class="fa fa-check"></i><b>1.2.2</b> What do we know about NOCs?</a></li>
<li class="chapter" data-level="1.2.3" data-path="paper1.html"><a href="paper1.html#noc-internationalization-opportunities-for-research"><i class="fa fa-check"></i><b>1.2.3</b> NOC internationalization: opportunities for research</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="paper1.html"><a href="paper1.html#approach01"><i class="fa fa-check"></i><b>1.3</b> Empirical Approach</a></li>
<li class="chapter" data-level="1.4" data-path="paper1.html"><a href="paper1.html#analysis01"><i class="fa fa-check"></i><b>1.4</b> Analysis</a><ul>
<li class="chapter" data-level="1.4.1" data-path="paper1.html"><a href="paper1.html#descriptivestats01"><i class="fa fa-check"></i><b>1.4.1</b> How does NOC internationalization vary?</a></li>
<li class="chapter" data-level="1.4.2" data-path="paper1.html"><a href="paper1.html#network01"><i class="fa fa-check"></i><b>1.4.2</b> What does the international NOC network look like?</a></li>
<li class="chapter" data-level="1.4.3" data-path="paper1.html"><a href="paper1.html#iocnoc01"><i class="fa fa-check"></i><b>1.4.3</b> Are there political differences in how NOCs invest?</a></li>
</ul></li>
<li class="chapter" data-level="1.5" data-path="paper1.html"><a href="paper1.html#conclusion01"><i class="fa fa-check"></i><b>1.5</b> Discussion</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="paper2.html"><a href="paper2.html"><i class="fa fa-check"></i><b>2</b> Why do some NOCs go global?</a><ul>
<li class="chapter" data-level="2.1" data-path="paper2.html"><a href="paper2.html#intro02"><i class="fa fa-check"></i><b>2.1</b> Introduction</a></li>
<li class="chapter" data-level="2.2" data-path="paper2.html"><a href="paper2.html#motiv02"><i class="fa fa-check"></i><b>2.2</b> Motivation</a><ul>
<li class="chapter" data-level="2.2.1" data-path="paper2.html"><a href="paper2.html#the-commercial-argument"><i class="fa fa-check"></i><b>2.2.1</b> The Commercial Argument</a></li>
<li class="chapter" data-level="2.2.2" data-path="paper2.html"><a href="paper2.html#the-resourcemarket-security-argument"><i class="fa fa-check"></i><b>2.2.2</b> The Resource/Market Security Argument</a></li>
<li class="chapter" data-level="2.2.3" data-path="paper2.html"><a href="paper2.html#the-political-institutions-argument"><i class="fa fa-check"></i><b>2.2.3</b> The Political Institutions Argument</a></li>
<li class="chapter" data-level="2.2.4" data-path="paper2.html"><a href="paper2.html#the-strategic-argument"><i class="fa fa-check"></i><b>2.2.4</b> The Strategic Argument</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="paper2.html"><a href="paper2.html#approach02"><i class="fa fa-check"></i><b>2.3</b> Methodology: Graphical Causal Modelling</a></li>
<li class="chapter" data-level="2.4" data-path="paper2.html"><a href="paper2.html#theory02"><i class="fa fa-check"></i><b>2.4</b> Theory: A Causal Model of NOC Internationalization</a></li>
</ul></li>
<li class="appendix"><span><b>Appendix</b></span></li>
<li class="chapter" data-level="A" data-path="appA.html"><a href="appA.html"><i class="fa fa-check"></i><b>A</b> Data ETL</a><ul>
<li class="chapter" data-level="A.1" data-path="appA.html"><a href="appA.html#subsidiary-level-dataset"><i class="fa fa-check"></i><b>A.1</b> Subsidiary-Level Dataset</a></li>
<li class="chapter" data-level="A.2" data-path="appA.html"><a href="appA.html#other-datasets"><i class="fa fa-check"></i><b>A.2</b> Other Datasets</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="colophon.html"><a href="colophon.html"><i class="fa fa-check"></i>Colophon</a></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">National Oil Companies as International Investors</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="appA" class="section level1">
<h1><span class="header-section-number">A</span> Data ETL</h1>
<p>The purpose of this appendix is to provide reproducible code for the extract, transform, and load process for the datasets at the core of this research project.</p>
<div id="subsidiary-level-dataset" class="section level2">
<h2><span class="header-section-number">A.1</span> Subsidiary-Level Dataset</h2>
<p>This dataset us build on an initial export of corporate data from the Capital IQ financial database; unfortunately this step was not performed in a programmatic way, making full replication impossible. The replication starting point is the tables developed by appending individual parent corporate hierarchy tables together to create a master list of all subsidiaries for all firms. The first code chunk below performs the following actions to initiate the reproducible ETL process.</p>
<ul>
<li>Read in the excel file containing NOC subsidiaries</li>
<li>Select only the required columns</li>
<li>Modify the <code>headquarters</code> variable by splitting into city and country information as separate columns</li>
<li>Where necessary, replace missing <code>subsidiary_country</code> information</li>
<li>Code a <code>Status</code> variable that indicates whether or not a given subsidiary is domestic or international, depending on the match between parent <code>country</code> and <code>subsidiary_country</code></li>
<li>Assign all rows an NOC identifier as <code>Type</code></li>
<li>Repeat for the non-NOC (IOC dataset)</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(readxl)
<span class="kw">library</span>(tidyverse)

noc &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;data/raw/original_data/capIQ_CorporateTree.xlsx&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(firm, subsidiary, relationship, stake, percent, industry, headquarters) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(headquarters, 
           <span class="kw">c</span>(<span class="st">&quot;sub_city&quot;</span>,<span class="st">&quot;subsidiary_country&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; </span><span class="ch">\\</span><span class="st">| &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">subsidiary_country =</span>
           <span class="kw">ifelse</span>(<span class="kw">is.na</span>(subsidiary_country), sub_city, subsidiary_country)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>sub_city) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(., <span class="kw">read_excel</span>(<span class="st">&quot;data/raw/original_data/capIQ_firms_FINAL.xlsx&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Status =</span> 
           <span class="kw">ifelse</span>(country <span class="op">==</span><span class="st"> </span>subsidiary_country, <span class="st">&quot;domestic&quot;</span>, <span class="st">&quot;international&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Type =</span> <span class="st">&quot;NOC&quot;</span>)

ioc &lt;-<span class="st"> </span><span class="kw">read_excel</span>(<span class="st">&quot;data/raw/original_data/FTSE_CorporateTree.xlsx&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(firm, subsidiary, relationship, stake, percent, headquarters) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">separate</span>(headquarters, <span class="kw">c</span>(<span class="st">&quot;sub_city&quot;</span>,<span class="st">&quot;subsidiary_country&quot;</span>), <span class="dt">sep =</span> <span class="st">&quot; </span><span class="ch">\\</span><span class="st">| &quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">subsidiary_country =</span>
           <span class="kw">ifelse</span>(<span class="kw">is.na</span>(subsidiary_country), sub_city, subsidiary_country)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>sub_city) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(., <span class="kw">read_excel</span>(<span class="st">&quot;data/raw/original_data/FTSE_final.xlsx&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Status =</span> 
           <span class="kw">ifelse</span>(country <span class="op">==</span><span class="st"> </span>subsidiary_country, <span class="st">&quot;domestic&quot;</span>, <span class="st">&quot;international&quot;</span>)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">Type =</span> <span class="st">&quot;IOC&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>ticker, <span class="op">-</span>market.cap, <span class="op">-</span>revenue, <span class="op">-</span>close)</code></pre></div>
<p>Once the <code>noc</code> and <code>ioc</code> datasets have been effectively loaded into the <code>R</code> environment with the code above, we combine them into a <code>subsidiary_dataset</code> using the code below (which also fills in missing <code>shortname</code> data with the full parent firm name where necessary):</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subsidiary_dataset &lt;-<span class="st"> </span><span class="kw">rbind</span>(noc, ioc) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">shortname =</span> <span class="kw">ifelse</span>(<span class="kw">is.na</span>(shortname), firm, shortname))</code></pre></div>
<p>The <code>subsidiary_dataset</code> contains all of our core information for understanding NOC (and IOC) subsidiaries. For instance, moving from this dataset to a count of international subsidiaries for each NOC is trivial:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">subsidiary_dataset <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">filter</span>(Type <span class="op">==</span><span class="st"> &quot;NOC&quot;</span> <span class="op">&amp;</span><span class="st"> </span>Status <span class="op">==</span><span class="st"> &quot;international&quot;</span>) <span class="op">%&gt;%</span><span class="st"> </span>
<span class="st">  </span><span class="kw">count</span>(shortname, <span class="dt">sort =</span> T)</code></pre></div>
<p>Once this core dataset is in place, we can supplement it with other information useful for our analysis. Many of these can be found in the Quality of Governance datasets, which can be helpfully accessed through the <code>rqog</code> library in <code>R</code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">library</span>(rqog)

qog &lt;-<span class="st"> </span><span class="kw">read_qog</span>(<span class="dt">which_data =</span> <span class="st">&quot;basic&quot;</span>, 
                <span class="dt">data_type =</span> <span class="st">&quot;cross-sectional&quot;</span>) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(cname, ccode, ccodecow, ccodealp)</code></pre></div>
<p>However our <code>country</code> and <code>subsidiary_country</code> fields in our <code>subsidiary_dataset</code> aren’t always a 1:1 match with the same data in the QOG dataset, and so we have to do a little bit of manual re-coding to establish an appropriate join key for the datasets. Instead of doing this in the base <code>subsidiary_country</code> dataset, we perform this step in a separate lookup table that contains distinct records of any <code>country</code> or <code>subsidiary_country</code> value. The code below contains the following steps:</p>
<ul>
<li>isolate <code>country</code> and take a distinct record of all countries</li>
<li>append <code>subsidiary_country</code> records</li>
<li>recode problem countries using <code>dplyr</code>’s <code>case_when</code> function</li>
<li>join with the <code>qog</code> dataset using cname as a join key</li>
</ul>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">state_lookup &lt;-<span class="st"> </span>subsidiary_dataset <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(country) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">full_join</span>(., subsidiary_dataset <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">select</span>(subsidiary_country) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">rename</span>(<span class="dt">country =</span> subsidiary_country)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country_new =</span> 
           <span class="kw">case_when</span>(<span class="kw">grepl</span>(<span class="st">&quot;Bosnia&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Bosnia and Herzegovina&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;TimorLeste&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Timor-Leste&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Antigua &amp; Barbuda&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Antigua and Barbuda&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Cyprus&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Cyprus (1975-)&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Ethiopia&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Ethiopia (1993-)&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;France&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;France (1963-)&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;GuineaBissau&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Guinea-Bissau&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Ivory Coast&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Cote d&#39;Ivoire&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Malaysia&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Malaysia (1966-)&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Pakistan&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Pakistan (1971-)&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Republic of the Congo&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Congo, Democratic Republic&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Saint Kitts &amp; Nevis&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;St Kitts and Nevis&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;South Korea&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Korea, South&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Sudan&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Sudan (2012-)&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Trinidad &amp; Tobago&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Trinidad and Tobago&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Aruba|Cura|Antilles&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;Netherlands&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Virgin Is|Cayman|Channel|Gibraltar|Bermuda|of Man|Anguilla&quot;</span>,
                           country) <span class="op">~</span><span class="st"> &quot;United Kingdom&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Martinique|Guadeloupe|Reunion|New Caledonia&quot;</span>,
                           country) <span class="op">~</span><span class="st"> &quot;France (1963-)&quot;</span>,
                     <span class="kw">grepl</span>(<span class="st">&quot;Hong Kong|Macau&quot;</span>, country) <span class="op">~</span><span class="st"> &quot;China&quot;</span>,
                     <span class="ot">TRUE</span> <span class="op">~</span><span class="st"> </span>country)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">distinct</span>() <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(., qog <span class="op">%&gt;%</span><span class="st"> </span><span class="kw">rename</span>(<span class="dt">country_new =</span> cname)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">arrange</span>(country)</code></pre></div>
<p>The <code>state_lookup</code> now allows us to fix country values in the main <code>subsidiary_dataset</code> and facilitate a join to the <code>qog</code> table. In the code below we</p>
<ul>
<li>Join <code>subsidiary_dataset</code> with <code>state_lookup</code></li>
<li>Fix the <code>country_variable</code> by replacing instances where it does not match <code>country_new</code></li>
<li>Re-join with <code>state_lookup</code>, this time on <code>subsidiary_country</code></li>
<li>Fix the <code>subsidiary_country</code> variable</li>
</ul>
<p>We can also add in latitude and longitude data courtesy of the Google Geocoding API. The first three lines of the code below faciliate this step.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">register_google</span>(<span class="dt">key =</span> <span class="st">&quot;Insert Your Key Here.&quot;</span>)
geocodes &lt;-<span class="st"> </span><span class="kw">geocode</span>(state_lookup<span class="op">$</span>location)
state_lookup &lt;-<span class="st"> </span><span class="kw">cbind</span>(state_lookup, geocodes)

subsidiary_dataset_FINAL &lt;-<span class="st"> </span>subsidiary_dataset <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(., state_lookup <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">select</span>(country, country_new, ccode, ccodealp, lat, lon)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">country =</span> <span class="kw">if_else</span>(country <span class="op">==</span><span class="st"> </span>country_new, country, country_new)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">left_join</span>(., state_lookup <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">select</span>(country, country_new, ccode, ccodealp, lat, lon) <span class="op">%&gt;%</span>
<span class="st">              </span><span class="kw">rename</span>(<span class="dt">subsidiary_country =</span> country,
                     <span class="dt">sub_country_new =</span> country_new,
                     <span class="dt">subsidiary_ccode =</span> ccode,
                     <span class="dt">subsidiary_ccodealp =</span> ccodealp,
                     <span class="dt">lat.y =</span> lat,
                     <span class="dt">lon.y =</span> lon)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">mutate</span>(<span class="dt">subsidiary_country =</span> <span class="kw">if_else</span>(subsidiary_country <span class="op">==</span><span class="st"> </span>sub_country_new,
                                      subsidiary_country, sub_country_new)) <span class="op">%&gt;%</span>
<span class="st">  </span><span class="kw">select</span>(<span class="op">-</span>country_new, <span class="op">-</span>sub_country_new)</code></pre></div>
<p>Once these steps are complete we can save copies of the final dataset locally:</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r"><span class="kw">saveRDS</span>(subsidiary_dataset_FINAL, <span class="dt">file =</span> <span class="st">&quot;out/subsidiary_dataset_FINAL.rds&quot;</span>)

<span class="kw">saveRDS</span>(state_lookup, <span class="dt">file =</span> <span class="st">&quot;out/state_lookup.rds&quot;</span>)

<span class="kw">save.image</span>(<span class="st">&quot;~/Dropbox/_Diss/data/out/etl_results.RData&quot;</span>)</code></pre></div>
</div>
<div id="other-datasets" class="section level2">
<h2><span class="header-section-number">A.2</span> Other Datasets</h2>
<!-- # Additional Figures {#appB} -->
<!-- ```{r boxplot1, fig.height = 4, fig.width = 6, fig.cap='Boxplot of International Subsidiaries', out.width='100%', fig.align='center', echo=TRUE} -->
<!-- df %>% -->
<!--   mutate(Type = factor(Type, levels = c("NOC", "IOC"))) %>% -->
<!--   filter(Status == "international") %>% -->
<!--   group_by(shortname, Type) %>% -->
<!--   summarize(n = n()) %>% -->
<!--   ggplot(aes(Type, n, group = Type, fill = Type)) + -->
<!--   geom_boxplot() + -->
<!--   geom_point() + -->
<!--   labs(y = "# of International Subsidiaries", -->
<!--        x = "") + -->
<!--   scale_y_log10() + -->
<!--   scale_fill_manual(values = c("#818ea0","#ccd2d9")) + -->
<!--   coord_flip() + -->
<!--   theme_few() + -->
<!--   theme(legend.position="none", -->
<!--         legend.title = element_blank()) -->
<!-- ``` -->
<!-- ```{r, eval=F} -->
<!-- subsidiary_dataset_FINAL %>% -->
<!--   filter(Status == "international" & Type == "NOC") %>% -->
<!--   count(shortname, country) %>% -->
<!--   arrange(-n) %>% -->
<!-- ``` -->
<!-- ```{r scat2, fig.height = 4, fig.width = 6, fig.cap='IOC and NOC internationalization compared', out.width='100%', fig.align='center', echo=TRUE} -->
<!-- df %>%  -->
<!--   #filter(Status == "international" & Type == "NOC") %>% -->
<!--   filter(Status == "international") %>% -->
<!--   count(shortname, subsidiary_country, Type, sort = T) %>% -->
<!--   group_by(shortname, Type) %>%  -->
<!--   mutate(total = sum(n), -->
<!--          n_countries = n()) %>% -->
<!--   summarize(international_subsidiaries = max(total), -->
<!--             different_countries = max(n_countries), -->
<!--             median_subsidiary_per_country = median(n)) %>%  -->
<!--   arrange(-international_subsidiaries) %>% -->
<!--   mutate(tag = case_when((international_subsidiaries > 80 | -->
<!--                            different_countries > 20) & Type == "NOC" ~ "tag", -->
<!--                          (international_subsidiaries > 250 | -->
<!--                            different_countries > 50) & Type == "IOC" ~ "tag", -->
<!--                          TRUE ~ "notag")) %>%  -->
<!--   ggplot(aes(international_subsidiaries, different_countries,  -->
<!--              group = Type, -->
<!--              color = Type, -->
<!--              label = shortname)) + -->
<!--   geom_point() + -->
<!--   ggrepel::geom_text_repel(data = . %>% -->
<!--                     mutate(label = ifelse(tag == "tag", -->
<!--                                           shortname, "")), -->
<!--                   aes(label = label), -->
<!--                   color = "#818ea0", -->
<!--                   size = 2.5, -->
<!--                   #box.padding = 1, -->
<!--                   show.legend = FALSE) + -->
<!--   labs(x = "# of International Subsidiaries", -->
<!--        y = "# of Different Subsidiary States") + -->
<!--   theme_few() + -->
<!--   #scale_color_manual(values = c("#ccd2d9","#818ea0")) + -->
<!--   scale_color_manual(values = c("black","black")) + -->
<!--   facet_wrap(~Type) + -->
<!--   theme(legend.position="none", -->
<!--         legend.title = element_blank()) -->
<!-- ``` -->
<!-- ```{r chinamap, fig.height = 2, fig.width = 8, fig.align= 'center', message=F, warning=F, echo=F, cache=T} -->
<!-- subsidiary_dataset_FINAL %>% -->
<!--   filter(Status == "international" & Type == "NOC") %>% -->
<!--   select(shortname, country, subsidiary_country, -->
<!--          lat, lon, lat.y, lon.y) %>% -->
<!--   group_by(shortname, subsidiary_country) %>%  -->
<!--   summarize(n_subs = n(), -->
<!--             lat = max(lat), -->
<!--             lon = max(lon), -->
<!--             lat.y = max(lat.y), -->
<!--             lon.y = max(lon.y)) %>%  -->
<!--   arrange(-n_subs) %>% -->
<!--   group_by(shortname) %>% -->
<!--   mutate(tot_n = sum(n_subs)) %>%  -->
<!--   filter(shortname %in% c("CNPC", "Sinopec", "CNOOC")) %>%  -->
<!--   na.omit() %>%  -->
<!--   ggplot() + -->
<!--   borders("world", colour = "white", fill = "seashell2") + -->
<!--   theme_void() + -->
<!--   coord_cartesian(ylim = c(-50, 80)) + -->
<!--   geom_curve(aes(x = lon, y = lat, -->
<!--                  xend = lon.y, yend = lat.y, -->
<!--                  color = n_subs), -->
<!--              curvature = .0) + -->
<!--   geom_point(aes(lon.y, lat.y, color = n_subs)) + -->
<!--   geom_point(aes(lon, lat)) + -->
<!--   facet_wrap(~shortname) + -->
<!--   scale_color_continuous(low = "grey70", high = "tomato") + -->
<!--   theme(legend.position="none", -->
<!--         legend.title = element_blank()) -->
<!-- ``` -->
<!-- ```{r africamap, fig.height = 3, fig.width = 8, fig.align= 'center', message=F, warning=F, echo=F, cache=T} -->
<!-- subsidiary_dataset_FINAL %>% -->
<!--   filter(Status == "international" & Type == "NOC") %>% -->
<!--   select(shortname, country, subsidiary_country, -->
<!--          lat, lon, lat.y, lon.y) %>% -->
<!--   group_by(shortname, subsidiary_country) %>%  -->
<!--   summarize(n_subs = n(), -->
<!--             lat = max(lat), -->
<!--             lon = max(lon), -->
<!--             lat.y = max(lat.y), -->
<!--             lon.y = max(lon.y)) %>%  -->
<!--   arrange(-n_subs) %>% -->
<!--   group_by(shortname) %>% -->
<!--   mutate(tot_n = sum(n_subs)) %>%  -->
<!--     filter(shortname %in% c("Sonangol", "Sonatrach", "NNPC","PetroSA","PETROCI", -->
<!--                           "ETAP","NOC Libya")) %>% -->
<!--   na.omit() %>%  -->
<!--   ggplot() + -->
<!--   borders("world", colour = "white", fill = "seashell2") + -->
<!--   theme_void() + -->
<!--   coord_cartesian(ylim = c(-50, 80)) + -->
<!--   geom_curve(aes(x = lon, y = lat, -->
<!--                  xend = lon.y, yend = lat.y, -->
<!--                  color = n_subs), -->
<!--              curvature = .0) + -->
<!--   geom_point(aes(lon.y, lat.y, color = n_subs)) + -->
<!--   geom_point(aes(lon, lat)) + -->
<!--   facet_wrap(~shortname) + -->
<!--   scale_color_continuous(low = "grey70", high = "tomato") + -->
<!--   theme(legend.position="none", -->
<!--         legend.title = element_blank()) -->
<!-- ``` -->
<!-- ```{r latamap, fig.height = 3, fig.width = 8, fig.align= 'center', message=F, warning=F, echo=F, cache=T} -->
<!-- subsidiary_dataset_FINAL %>% -->
<!--   filter(Status == "international" & Type == "NOC") %>% -->
<!--   select(shortname, country, subsidiary_country, -->
<!--          lat, lon, lat.y, lon.y) %>% -->
<!--   group_by(shortname, subsidiary_country) %>%  -->
<!--   summarize(n_subs = n(), -->
<!--             lat = max(lat), -->
<!--             lon = max(lon), -->
<!--             lat.y = max(lat.y), -->
<!--             lon.y = max(lon.y)) %>%  -->
<!--   arrange(-n_subs) %>% -->
<!--   group_by(shortname) %>% -->
<!--   mutate(tot_n = sum(n_subs)) %>%  -->
<!--   filter(shortname %in% c("Petrobras", "PDVSA", "Ecopetrol", "PEMEX", -->
<!--                           "ENAP","YPFB","CUPET","EP Petroecuador")) %>%  -->
<!--   na.omit() %>%  -->
<!--   ggplot() + -->
<!--   borders("world", colour = "white", fill = "seashell2") + -->
<!--   theme_void() + -->
<!--   coord_cartesian(ylim = c(-50, 80)) + -->
<!--   geom_curve(aes(x = lon, y = lat, -->
<!--                  xend = lon.y, yend = lat.y, -->
<!--                  color = n_subs), -->
<!--              curvature = .0) + -->
<!--   geom_point(aes(lon.y, lat.y, color = n_subs)) + -->
<!--   geom_point(aes(lon, lat)) + -->
<!--   facet_wrap(~shortname) + -->
<!--   scale_color_continuous(low = "grey70", high = "tomato") + -->
<!--   theme(legend.position="none", -->
<!--         legend.title = element_blank()) -->
<!-- ``` -->

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="paper2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="colophon.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"google": false,
"linkedin": false,
"weibo": false,
"instapper": false,
"vk": false,
"all": ["facebook", "google", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"download": [["thesis.pdf", "PDF"], ["thesis.epub", "EPUB"], ["thesis.docx", "Word"]],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "";
    if (src === "" || src === "true") src = "https://cdn.bootcss.com/mathjax/2.7.1/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:" && /^https?:/.test(src))
      src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
